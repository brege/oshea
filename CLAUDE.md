# CLAUDE.md

Project-specific guidance for the [oshea](https://github.com/brege/oshea) repository.

## Project Overview

`oshea` is a Node.js CLI tool that converts Markdown to PDF using markdown-it + puppeteer, with an extensible plugin system for different document types (CVs, cover letters, recipes, etc.).

## Essential Commands

```bash
npm test -- --group integration  # (fast) Run full test suite (250+ integration tests)
npm test -- --group e2e          # (slow) Run full test suite (100+ end-to-end tests)
npm run lint                     # Custom linting system
npm run paths                    # Regenerate path registry after moving files

# Usage
node cli.js convert file.md --plugin cv       # Convert with plugin
node cli.js plugin create --from cv my-plugin # Create new plugin
node cli.js --watch                           # Watch mode
```

## Essential Documentation

- `README.md`
- `docs/guides/claude-skills.md`
- `docs/refs/interaction-spec.md`
- `docs/guides/configuration-hierarchies.md`
- `docs/guides/plugin-development.md`
- `docs/refs/cheat-sheet.md`
- `docs/refs/plugin-contract.md`

Documentation is indexed by `README.md` files throughout the repository. These offer one-line summaries of each topic.

## Architecture

**Path System**: All imports use centralized path registry at `paths/index.js` (auto-generated from `paths/paths-config.yaml`). Use `@paths` alias, never relative paths. See `paths/README.md` for details.

**Core Structure**:
- `src/cli/` - Command definitions and CLI logic
- `src/core/` - PDF generation and markdown processing pipeline
- `src/config/` - Hierarchical configuration system
- `src/plugins/` - Plugin management (PluginManager, registry, archetyper)
- `plugins/` - Built-in plugins (cv, cover-letter, recipe, etc.)

**Testing**: Manifest-driven test harness with factory mocking. See `test/README.md` for details.

## Configuration Hierarchy

1. CLI flags (highest precedence)
2. User config (`~/.config/oshea/config.yaml`)
3. `config.example.yaml` (lowest precedence)

Plugin configs follow similar hierarchy with plugin-specific `.config.yaml` files.

See `docs/guides/configuration-hierarchies.md` for details.

## Development Notes

- All file moves require running `npm run paths` to update registry
- Plugins are self-contained with contract validation via `.contract` files
- Comprehensive documentation auto-generated by librarian script
- Use Biome config (`biome.json`)
- Feature-based architecture, not file-type based

## Code Rules

- File headers are required in JavaScript files: first comment must match the workspace-relative path (shebang may appear first).
- Do not call `console.*` for logging; use the project logger
- Only use `console.*` for temporary development instrumentation. Remove before committing. Don't remove consoles marked with `console-ok` at file head or single line.
- Do not call `chalk.*` in application code; use the project formatters. Formatters call chalk.
- Do not add JSDoc block comments (`/** ... @param ... */`) to source files.
- Do not use relative import/require paths or relative path fragments in path resolution; use `@paths`.
